<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Quote - Raciel Insulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .hero-bg {
            background-color: #0a192f;
            background-image: linear-gradient(135deg, #0a192f 0%, #172a46 100%);
        }

        .brand-text-raciel {
            font-weight: 900;
            font-size: 2.5rem;
            letter-spacing: -0.05em;
            color: white;
        }

        .brand-text-insulation {
            display: block;
            background-color: #e53e3e;
            color: white;
            padding: 0.25rem 1rem;
            font-weight: 700;
            font-size: 1.25rem;
            margin-top: -10px;
            text-align: center;
        }

        .brand-text-melbourne {
            color: #cbd5e1;
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-align: right;
            margin-top: 4px;
            padding-right: 1rem;
        }

        input[type="number"]:disabled,
        input[type="date"]:disabled {
            background-color: #334155;
            /* slate-700 */
            opacity: 0.5;
            cursor: not-allowed;
        }

        .radio-label {
            border: 2px solid #334155;
            /* slate-700 */
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .radio-label:hover {
            border-color: #475569;
            /* slate-600 */
        }

        input[type="radio"]:checked+.radio-label,
        input[type="checkbox"]:checked+.radio-label {
            border-color: #e53e3e;
            /* red-600 */
            background-color: #1e293b;
            /* slate-800 */
            box-shadow: 0 0 0 2px #e53e3e;
        }

        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            vertical-align: text-bottom;
            border: 0.25em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-slate-900">

    <!-- Navigation -->
    <nav class="hero-bg shadow-lg">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <!-- Logo -->
                <div class="relative inline-block">
                    <span class="brand-text-raciel">RACIEL</span>
                    <span class="brand-text-insulation">INSULATION</span>
                    <span class="brand-text-melbourne">MELBOURNE</span>
                </div>
            </div>
            <a href="index.html"
                class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-300">Back
                to Home</a>
        </div>
    </nav>

    <!-- Formulario de Cotización -->
    <div class="container mx-auto max-w-3xl mt-12 mb-12 px-4">

        <div id="quote-form-container" class="bg-slate-800 rounded-lg shadow-xl overflow-hidden p-8 md:p-12">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">Get Your Instant Quote</h2>
            <p class="text-slate-400 text-center mb-8">Fill out the form below to get an estimate for your job.</p>

            <form id="quote-form">

                <!-- Paso 1: Tipo de Servicio -->
                <fieldset class="mb-8">
                    <legend class="text-xl font-bold text-white mb-4">1. What service do you need?</legend>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="relative">
                            <input type="radio" name="serviceType" value="Installation Only"
                                class="absolute opacity-0 w-0 h-0" checked>
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Installation Only</span>
                            </div>
                        </label>
                        <label class="relative">
                            <input type="radio" name="serviceType" value="Removal & Cleaning"
                                class="absolute opacity-0 w-0 h-0">
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Removal & Cleaning</span>
                                <span class="text-sm text-slate-400">($15 / m²)</span>
                            </div>
                        </label>
                        <label class="relative">
                            <input type="radio" name="serviceType" value="Both (Removal & Installation)"
                                class="absolute opacity-0 w-0 h-0">
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Both</span>
                            </div>
                        </label>
                    </div>
                </fieldset>

                <!-- === NUEVO PASO 1.5: Add-ons === -->
                <fieldset id="removal-addons" class="mb-8 hidden">
                    <legend class="text-xl font-bold text-white mb-4">1.5. Removal Add-ons</legend>
                    <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                        <input type="checkbox" id="sanitising-treatment" name="sanitising-treatment"
                            class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                        <label for="sanitising-treatment" class="flex-1 text-lg text-slate-300 font-semibold">Ceiling
                            Sanitising Treatment</label>
                        <span class="text-lg text-slate-300 font-bold">$20.00</span>
                    </div>
                </fieldset>

                <!-- Paso 2: Nivel de Instalación (Oculto por defecto) -->
                <fieldset id="installation-options" class="mb-8">
                    <legend class="text-xl font-bold text-white mb-4">2. Select Installation Quality</legend>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="relative">
                            <input type="radio" name="installationLevel" value="Basic"
                                class="absolute opacity-0 w-0 h-0" checked>
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Basic</span>
                                <span class="text-sm text-slate-400">($20 / m²)</span>
                            </div>
                        </label>
                        <label class="relative">
                            <input type="radio" name="installationLevel" value="Standard"
                                class="absolute opacity-0 w-0 h-0">
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Standard</span>
                                <span class="text-sm text-slate-400">($25 / m²)</span>
                            </div>
                        </label>
                        <label class="relative">
                            <input type="radio" name="installationLevel" value="Premium"
                                class="absolute opacity-0 w-0 h-0">
                            <div class="radio-label text-center text-slate-300">
                                <span class="text-lg font-semibold">Premium</span>
                                <span class="text-sm text-slate-400">($34 / m²)</span>
                            </div>
                        </label>
                    </div>
                </fieldset>

                <!-- Paso 3: Áreas y Metros Cuadrados -->
                <fieldset class="mb-8">
                    <legend class="text-xl font-bold text-white mb-4" id="areas-legend">3. Which areas need service?
                    </legend>
                    <div class="space-y-4">
                        <!-- Ceiling -->
                        <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                            <input type="checkbox" id="area-ceiling" name="area-ceiling"
                                class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                            <label for="area-ceiling" class="flex-1 text-lg text-slate-300 font-semibold">Ceiling /
                                Roof</label>
                            <input type="number" id="ceiling-sqm" placeholder="m²"
                                class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                                min="0" disabled>
                        </div>
                        <!-- Walls -->
                        <div id="walls-area-container" class="flex flex-col gap-4 p-4 bg-slate-700 rounded-lg">
                            <!-- MODIFICADO: flex-col y gap-4 -->
                            <div class="flex items-center gap-4"> <!-- Contenedor original -->
                                <input type="checkbox" id="area-walls" name="area-walls"
                                    class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                                <label for="area-walls"
                                    class="flex-1 text-lg text-slate-300 font-semibold">Walls</label>
                                <input type="number" id="walls-sqm" placeholder="m²"
                                    class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                                    min="0" disabled>
                            </div>
                            <!-- NUEVO: Opciones de Plantas para Paredes -->
                            <div id="walls-storey-options" class="hidden pl-10 space-y-2">
                                <label class="block text-slate-300 text-sm">Is it a single or double storey?</label>
                                <!-- TEXTO CAMBIADO -->
                                <div class="flex gap-4">
                                    <label class="relative">
                                        <input type="radio" name="wallStoreys" value="1"
                                            class="absolute opacity-0 w-0 h-0" checked>
                                        <div class="radio-label text-sm py-2 px-4">Single Storey</div>
                                        <!-- TEXTO CAMBIADO -->
                                    </label>
                                    <label class="relative">
                                        <input type="radio" name="wallStoreys" value="2"
                                            class="absolute opacity-0 w-0 h-0">
                                        <div class="radio-label text-sm py-2 px-4">Double Storey</div>
                                        <!-- TEXTO CAMBIADO -->
                                    </label>
                                </div>
                            </div>
                        </div>
                        <!-- Floor -->
                        <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                            <input type="checkbox" id="area-floor" name="area-floor"
                                class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                            <label for="area-floor" class="flex-1 text-lg text-slate-300 font-semibold">Floor
                                (Underfloor)</label>
                            <input type="number" id="floor-sqm" placeholder="m²"
                                class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                                min="0" disabled>
                        </div>
                    </div>
                </fieldset>

                <!-- Paso 4: Detalles de Contacto -->
                <fieldset class="mb-8">
                    <legend class="text-xl font-bold text-white mb-4">4. Your Contact Details</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="contact-name" class="block text-slate-300 mb-2">Full Name</label>
                            <input type="text" id="contact-name"
                                class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                                required>
                        </div>
                        <div>
                            <label for="contact-phone" class="block text-slate-300 mb-2">Phone</label>
                            <input type="tel" id="contact-phone"
                                class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                                required>
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="contact-email" class="block text-slate-300 mb-2">Email</label>
                        <input type="email" id="contact-email"
                            class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                            required>
                    </div>
                    <!-- === NUEVO CAMPO DE FECHA === -->
                    <div class="mt-6">
                        <label for="contact-date" class="block text-slate-300 mb-2">Preferred Service Date</label>
                        <input type="date" id="contact-date"
                            class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                            required>
                    </div>
                </fieldset>

                <!-- Total Estimado -->
                <div id="total-cost-container"
                    class="bg-slate-900 rounded-lg p-6 mb-8 sticky bottom-4 shadow-lg border border-slate-700">
                    <div class="flex justify-between items-center">
                        <span class="text-2xl font-bold text-white">Estimated Total:</span>
                        <span id="total-cost-display" class="text-3xl font-extrabold text-red-500">$0.00</span>
                    </div>
                    <p class="text-slate-400 text-sm mt-2">This is an estimate. A final quote will be provided after
                        confirming job details.</p>
                </div>

                <!-- ✨ Botón de Gemini ✨ (REMOVED) -->

                <!-- ✨ Contenedor de Resultados de Gemini (Oculto) -->
                <!-- ... (REMOVED) ... -->

                <!-- Botón de Envío -->
                <div class="text-center">
                    <button type="submit"
                        class="w-full md:w-auto bg-red-600 text-white font-bold py-3 px-10 rounded-lg text-lg hover:bg-red-700 transition duration-300 transform hover:scale-105">
                        Get My Quote
                    </button>
                </div>
            </form>
        </div>

        <!-- Mensaje de Éxito (Oculto) -->
        <div id="success-message" class="hidden text-center bg-slate-800 rounded-lg shadow-xl p-12">
            <!-- ... (Sin cambios) ... -->
        </div>

        <!-- Mensaje de Error (Oculto) -->
        <div id="error-message"
            class="hidden text-center text-red-400 mt-4 p-4 bg-red-900 border border-red-700 rounded-lg">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <label class="relative">
                    <input type="radio" name="serviceType" value="Installation Only" class="absolute opacity-0 w-0 h-0"
                        checked>
                    <div class="radio-label text-center text-slate-300">
                        <span class="text-lg font-semibold">Installation Only</span>
                    </div>
                </label>
                <label class="relative">
                    <input type="radio" name="serviceType" value="Removal & Cleaning"
                        class="absolute opacity-0 w-0 h-0">
                    <div class="radio-label text-center text-slate-300">
                        <span class="text-lg font-semibold">Removal & Cleaning</span>
                        <span class="text-sm text-slate-400">($15 / m²)</span>
                    </div>
                </label>
                <label class="relative">
                    <input type="radio" name="serviceType" value="Both (Removal & Installation)"
                        class="absolute opacity-0 w-0 h-0">
                    <div class="radio-label text-center text-slate-300">
                        <span class="text-lg font-semibold">Both</span>
                    </div>
                </label>
            </div>
            </fieldset>

            <!-- === NUEVO PASO 1.5: Add-ons === -->
            <fieldset id="removal-addons" class="mb-8 hidden">
                <legend class="text-xl font-bold text-white mb-4">1.5. Removal Add-ons</legend>
                <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                    <input type="checkbox" id="sanitising-treatment" name="sanitising-treatment"
                        class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                    <label for="sanitising-treatment" class="flex-1 text-lg text-slate-300 font-semibold">Ceiling
                        Sanitising Treatment</label>
                    <span class="text-lg text-slate-300 font-bold">$20.00</span>
                </div>
            </fieldset>

            <!-- Paso 2: Nivel de Instalación (Oculto por defecto) -->
            <fieldset id="installation-options" class="mb-8">
                <legend class="text-xl font-bold text-white mb-4">2. Select Installation Quality</legend>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <label class="relative">
                        <input type="radio" name="installationLevel" value="Basic" class="absolute opacity-0 w-0 h-0"
                            checked>
                        <div class="radio-label text-center text-slate-300">
                            <span class="text-lg font-semibold">Basic</span>
                            <span class="text-sm text-slate-400">($20 / m²)</span>
                        </div>
                    </label>
                    <label class="relative">
                        <input type="radio" name="installationLevel" value="Standard"
                            class="absolute opacity-0 w-0 h-0">
                        <div class="radio-label text-center text-slate-300">
                            <span class="text-lg font-semibold">Standard</span>
                            <span class="text-sm text-slate-400">($25 / m²)</span>
                        </div>
                    </label>
                    <label class="relative">
                        <input type="radio" name="installationLevel" value="Premium" class="absolute opacity-0 w-0 h-0">
                        <div class="radio-label text-center text-slate-300">
                            <span class="text-lg font-semibold">Premium</span>
                            <span class="text-sm text-slate-400">($34 / m²)</span>
                        </div>
                    </label>
                </div>
            </fieldset>

            <!-- Paso 3: Áreas y Metros Cuadrados -->
            <fieldset class="mb-8">
                <legend class="text-xl font-bold text-white mb-4" id="areas-legend">3. Which areas need service?
                </legend>
                <div class="space-y-4">
                    <!-- Ceiling -->
                    <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                        <input type="checkbox" id="area-ceiling" name="area-ceiling"
                            class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                        <label for="area-ceiling" class="flex-1 text-lg text-slate-300 font-semibold">Ceiling /
                            Roof</label>
                        <input type="number" id="ceiling-sqm" placeholder="m²"
                            class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                            min="0" disabled>
                    </div>
                    <!-- Walls -->
                    <div id="walls-area-container" class="flex flex-col gap-4 p-4 bg-slate-700 rounded-lg">
                        <!-- MODIFICADO: flex-col y gap-4 -->
                        <div class="flex items-center gap-4"> <!-- Contenedor original -->
                            <input type="checkbox" id="area-walls" name="area-walls"
                                class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                            <label for="area-walls" class="flex-1 text-lg text-slate-300 font-semibold">Walls</label>
                            <input type="number" id="walls-sqm" placeholder="m²"
                                class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                                min="0" disabled>
                        </div>
                        <!-- NUEVO: Opciones de Plantas para Paredes -->
                        <div id="walls-storey-options" class="hidden pl-10 space-y-2">
                            <label class="block text-slate-300 text-sm">Is it a single or double storey?</label>
                            <!-- TEXTO CAMBIADO -->
                            <div class="flex gap-4">
                                <label class="relative">
                                    <input type="radio" name="wallStoreys" value="1" class="absolute opacity-0 w-0 h-0"
                                        checked>
                                    <div class="radio-label text-sm py-2 px-4">Single Storey</div>
                                    <!-- TEXTO CAMBIADO -->
                                </label>
                                <label class="relative">
                                    <input type="radio" name="wallStoreys" value="2" class="absolute opacity-0 w-0 h-0">
                                    <div class="radio-label text-sm py-2 px-4">Double Storey</div>
                                    <!-- TEXTO CAMBIADO -->
                                </label>
                            </div>
                        </div>
                    </div>
                    <!-- Floor -->
                    <div class="flex items-center gap-4 p-4 bg-slate-700 rounded-lg">
                        <input type="checkbox" id="area-floor" name="area-floor"
                            class="h-6 w-6 text-red-600 bg-slate-800 border-slate-600 rounded focus:ring-red-500">
                        <label for="area-floor" class="flex-1 text-lg text-slate-300 font-semibold">Floor
                            (Underfloor)</label>
                        <input type="number" id="floor-sqm" placeholder="m²"
                            class="w-28 bg-slate-600 text-white rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                            min="0" disabled>
                    </div>
                </div>
            </fieldset>

            <!-- Paso 4: Detalles de Contacto -->
            <fieldset class="mb-8">
                <legend class="text-xl font-bold text-white mb-4">4. Your Contact Details</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="contact-name" class="block text-slate-300 mb-2">Full Name</label>
                        <input type="text" id="contact-name"
                            class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                            required>
                    </div>
                    <div>
                        <label for="contact-phone" class="block text-slate-300 mb-2">Phone</label>
                        <input type="tel" id="contact-phone"
                            class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                            required>
                    </div>
                </div>
                <div class="mt-6">
                    <label for="contact-email" class="block text-slate-300 mb-2">Email</label>
                    <input type="email" id="contact-email"
                        class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                        required>
                </div>
                <!-- === NUEVO CAMPO DE FECHA === -->
                <div class="mt-6">
                    <label for="contact-date" class="block text-slate-300 mb-2">Preferred Service Date</label>
                    <input type="date" id="contact-date"
                        class="w-full bg-slate-700 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-red-500"
                        required>
                </div>
            </fieldset>

            <!-- Total Estimado -->
            <div id="total-cost-container"
                class="bg-slate-900 rounded-lg p-6 mb-8 sticky bottom-4 shadow-lg border border-slate-700">
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-white">Estimated Total:</span>
                    <span id="total-cost-display" class="text-3xl font-extrabold text-red-500">$0.00</span>
                </div>
                <p class="text-slate-400 text-sm mt-2">This is an estimate. A final quote will be provided after
                    confirming job details.</p>
            </div>

            <!-- ✨ Botón de Gemini ✨ (REMOVED) -->

            <!-- ✨ Contenedor de Resultados de Gemini (Oculto) -->
            <!-- ... (REMOVED) ... -->

            <!-- Botón de Envío -->
            <div class="text-center">
                <button type="submit"
                    class="w-full md:w-auto bg-red-600 text-white font-bold py-3 px-10 rounded-lg text-lg hover:bg-red-700 transition duration-300 transform hover:scale-105">
                    Get My Quote
                </button>
            </div>
            </form>
        </div>

        <!-- Mensaje de Éxito (Oculto) -->
        <div id="success-message" class="hidden text-center bg-slate-800 rounded-lg shadow-xl p-12">
            <!-- ... (Sin cambios) ... -->
        </div>

        <!-- Mensaje de Error (Oculto) -->
        <div id="error-message"
            class="hidden text-center text-red-400 mt-4 p-4 bg-red-900 border border-red-700 rounded-lg">
            <!-- ... (Sin cambios) ... -->
        </div>

    </div>

    <script>
        // --- Precios ---
        const PRICE_REMOVAL = 15;
        const PRICE_INSTALL_BASIC = 20;
        const PRICE_INSTALL_STANDARD = 25;
        const PRICE_INSTALL_PREMIUM = 34;
        const PRICE_SANITISING = 20;

        // --- Elementos del DOM ---
        const formContainer = document.getElementById('quote-form-container');
        const form = document.getElementById('quote-form');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const submitButton = form.querySelector('button[type="submit"]');

        const serviceTypeRadios = document.querySelectorAll('input[name="serviceType"]');
        const installationLevelRadios = document.querySelectorAll('input[name="installationLevel"]');
        const sanitisingCheckbox = document.getElementById('sanitising-treatment');

        const installationOptions = document.getElementById('installation-options');
        const areasLegend = document.getElementById('areas-legend');
        const removalAddons = document.getElementById('removal-addons');
        const wallsAreaContainer = document.getElementById('walls-area-container');

        // --- N8N Webhook Function ---
        async function sendToN8N(quoteData) {
            const n8nWebhookUrl = 'https://n8n.solidiaai.com/webhook/aa675519-c431-43d2-9e0e-73f4f4d82a8e';
            console.log("Sending data to n8n:", quoteData);

            const response = await fetch(n8nWebhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(quoteData)
            });

            if (!response.ok) {
                throw new Error(`Server returned status ${response.status}`);
            }

            // Try to parse JSON if possible, but don't fail if it's just text
            const text = await response.text();
            try {
                return JSON.parse(text);
            } catch (e) {
                return text;
            }
        }

        function toggleSqmInput(checkboxId, inputId) {
            const checkbox = document.getElementById(checkboxId);
            const input = document.getElementById(inputId);

            if (!checkbox || !input) return;

            const wallsStoreyOptions = document.getElementById('walls-storey-options');

            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    input.disabled = false;
                    input.required = true;
                    input.focus();
                    if (checkboxId === 'area-walls' && wallsStoreyOptions) {
                        wallsStoreyOptions.classList.remove('hidden');
                    }
                } else {
                    input.disabled = true;
                    input.required = false;
                    input.value = '';
                    if (checkboxId === 'area-walls' && wallsStoreyOptions) {
                        wallsStoreyOptions.classList.add('hidden');
                    }
                }
                calculateTotal();
            });

            input.addEventListener('input', calculateTotal);
        }

        function toggleInstallOptions() {
            const selectedService = form.querySelector('input[name="serviceType"]:checked').value;

            if (!installationOptions || !areasLegend || !removalAddons || !wallsAreaContainer) return;

            if (selectedService === 'Removal & Cleaning') {
                installationOptions.classList.add('hidden');
                areasLegend.textContent = "3. Which areas need cleaning?";

                removalAddons.classList.remove('hidden');
                wallsAreaContainer.classList.add('hidden');

                // Clear walls if hidden
                const wallsCheckbox = document.getElementById('area-walls');
                const wallsSqm = document.getElementById('walls-sqm');
                if (wallsCheckbox) wallsCheckbox.checked = false;
                if (wallsSqm) {
                    wallsSqm.value = '';
                    wallsSqm.disabled = true;
                }

            } else if (selectedService === 'Installation Only') {
                installationOptions.classList.remove('hidden');
                areasLegend.textContent = "3. Which areas need installation?";

                removalAddons.classList.add('hidden');
                if (sanitisingCheckbox) sanitisingCheckbox.checked = false;
                wallsAreaContainer.classList.remove('hidden');

            } else { // Both
                installationOptions.classList.remove('hidden');
                areasLegend.textContent = "3. Which areas need service?";

                removalAddons.classList.remove('hidden');
                wallsAreaContainer.classList.add('hidden');

                // Clear walls if hidden
                const wallsCheckbox = document.getElementById('area-walls');
                const wallsSqm = document.getElementById('walls-sqm');
                if (wallsCheckbox) wallsCheckbox.checked = false;
                if (wallsSqm) {
                    wallsSqm.value = '';
                    wallsSqm.disabled = true;
                }
            }

            calculateTotal();
        }

        function calculateTotal() {
            let totalSqm = 0;
            let installCost = 0;
            let removalCost = 0;
            let sanitisingCost = 0;

            const serviceType = form.querySelector('input[name="serviceType"]:checked').value;

            let installLevel = null;
            let installPricePerSqm = 0;
            if (serviceType === 'Installation Only' || serviceType === 'Both (Removal & Installation)') {
                const selectedLevelRadio = form.querySelector('input[name="installationLevel"]:checked');
                if (selectedLevelRadio) {
                    installLevel = selectedLevelRadio.value;
                    if (installLevel === 'Basic') installPricePerSqm = PRICE_INSTALL_BASIC;
                    else if (installLevel === 'Standard') installPricePerSqm = PRICE_INSTALL_STANDARD;
                    else if (installLevel === 'Premium') installPricePerSqm = PRICE_INSTALL_PREMIUM;
                }
            }

            // Ceiling
            const ceilingCheckbox = document.getElementById('area-ceiling');
            const ceilingSqmVal = parseFloat(document.getElementById('ceiling-sqm').value) || 0;
            if (ceilingCheckbox && ceilingCheckbox.checked && ceilingSqmVal > 0) {
                totalSqm += ceilingSqmVal;
                if (serviceType === 'Removal & Cleaning' || serviceType === 'Both (Removal & Installation)') {
                    removalCost += ceilingSqmVal * PRICE_REMOVAL;
                }
                if (serviceType === 'Installation Only' || serviceType === 'Both (Removal & Installation)') {
                    installCost += ceilingSqmVal * installPricePerSqm;
                }
            }

            // Walls
            const wallsCheckbox = document.getElementById('area-walls');
            const wallsSqmVal = parseFloat(document.getElementById('walls-sqm').value) || 0;
            if (wallsCheckbox && wallsCheckbox.checked && wallsSqmVal > 0 && serviceType === 'Installation Only') {
                totalSqm += wallsSqmVal;
                const wallStoreys = form.querySelector('input[name="wallStoreys"]:checked').value;
                const wallMultiplier = (wallStoreys === "2") ? 2 : 1;
                installCost += (wallsSqmVal * installPricePerSqm) * wallMultiplier;
            }

            // Floor
            const floorCheckbox = document.getElementById('area-floor');
            const floorSqmVal = parseFloat(document.getElementById('floor-sqm').value) || 0;
            if (floorCheckbox && floorCheckbox.checked && floorSqmVal > 0) {
                totalSqm += floorSqmVal;
                if (serviceType === 'Removal & Cleaning' || serviceType === 'Both (Removal & Installation)') {
                    removalCost += floorSqmVal * PRICE_REMOVAL;
                }
                if (serviceType === 'Installation Only' || serviceType === 'Both (Removal & Installation)') {
                    installCost += floorSqmVal * installPricePerSqm;
                }
            }

            // Sanitising
            if (sanitisingCheckbox && sanitisingCheckbox.checked && (serviceType === 'Removal & Cleaning' || serviceType === 'Both (Removal & Installation)')) {
                sanitisingCost = PRICE_SANITISING;
            }

            const totalCost = installCost + removalCost + sanitisingCost;
            document.getElementById('total-cost-display').textContent = `$${totalCost.toFixed(2)}`;

            return { totalCost, installLevel, totalSqm };
        }

        // --- Init & Listeners ---
        toggleSqmInput('area-ceiling', 'ceiling-sqm');
        toggleSqmInput('area-walls', 'walls-sqm');
        toggleSqmInput('area-floor', 'floor-sqm');

        serviceTypeRadios.forEach(radio => radio.addEventListener('change', toggleInstallOptions));
        installationLevelRadios.forEach(radio => radio.addEventListener('change', calculateTotal));
        if (sanitisingCheckbox) sanitisingCheckbox.addEventListener('change', calculateTotal);

        toggleInstallOptions();
        calculateTotal();

        // --- Submit Handler ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessage.classList.add('hidden');
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';

            try {
                const { totalCost, installLevel, totalSqm } = calculateTotal();
                const areas = {};

                const ceilingCheckbox = document.getElementById('area-ceiling');
                if (ceilingCheckbox && ceilingCheckbox.checked) areas.ceiling_sqm = document.getElementById('ceiling-sqm').value || 0;

                const wallsCheckbox = document.getElementById('area-walls');
                let wallStoreys = null;
                if (wallsCheckbox && wallsCheckbox.checked) {
                    areas.walls_sqm = document.getElementById('walls-sqm').value || 0;
                    wallStoreys = form.querySelector('input[name="wallStoreys"]:checked').value;
                }

                const floorCheckbox = document.getElementById('area-floor');
                if (floorCheckbox && floorCheckbox.checked) areas.floor_sqm = document.getElementById('floor-sqm').value || 0;

                const quoteRequest = {
                    serviceType: form.querySelector('input[name="serviceType"]:checked').value,
                    installationLevel: installLevel,
                    areas: areas,
                    wallStoreys: wallStoreys,
                    totalSqm: totalSqm,
                    sanitisingTreatment: sanitisingCheckbox ? sanitisingCheckbox.checked : false,
                    preferredServiceDate: document.getElementById('contact-date').value,
                    estimatedTotalCost: totalCost.toFixed(2),
                    contact: {
                        name: document.getElementById('contact-name').value,
                        phone: document.getElementById('contact-phone').value,
                        email: document.getElementById('contact-email').value,
                    }
                };

                await sendToN8N(quoteRequest);

                formContainer.classList.add('hidden');
                successMessage.classList.remove('hidden');

            } catch (error) {
                console.error("Submission error:", error);
                errorMessage.classList.remove('hidden');
                errorMessage.innerHTML = `<p class="font-bold">Something went wrong.</p><p class="text-sm">${error.message}</p>`;
                submitButton.disabled = false;
                submitButton.textContent = 'Get My Quote';
            }
        });
    </script>
</body>

</html>